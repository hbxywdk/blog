<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="hbxywdk,hbxywdk@gmail.com"><title>阿里云安装Gitlab笔记 · DK'S BLOG</title><meta name="description" content="前置工作
一台阿里云服务器（2核4G以上）
配置服务器入方向安全组规则，我这里配置了8888端口（阿里云安全组出方向默认允许所有访问，所以不用配置）


Step1：安装和配置必要依赖项访问 Gitlab安装地址，选择对应系统的安装方式，我的是 CentOS 7.6 故选择 CentOS 7.X 的"><meta name="keywords" content="blog,FE,HTML,CSS,Javascript,Vue,Nuxt"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">DK'S BLOG</a></h3><div class="description"><p>Judge not from appearances.</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/DKWang8"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/3136805851"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/hbxywdk"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/de.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>阿里云安装Gitlab笔记</a></h3></div><div class="post-content"><h3 id="前置工作"><a href="#前置工作" class="headerlink" title="前置工作"></a>前置工作</h3><ol>
<li>一台阿里云服务器（2核4G以上）</li>
<li>配置服务器入方向安全组规则，我这里配置了8888端口（阿里云安全组出方向默认允许所有访问，所以不用配置）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hbxywdk/hexo-blog/master/assets/2019-04/safe-group.jpg" alt="配置入方向安全组"></p>
<h3 id="Step1：安装和配置必要依赖项"><a href="#Step1：安装和配置必要依赖项" class="headerlink" title="Step1：安装和配置必要依赖项"></a>Step1：安装和配置必要依赖项</h3><p>访问 <a href="https://about.gitlab.com/install/" target="_blank" rel="noopener">Gitlab安装地址</a>，选择对应系统的安装方式，我的是 CentOS 7.6 故选择 CentOS 7.X 的安装方式。 </p>
<h4 id="如何查看自己是什么系统："><a href="#如何查看自己是什么系统：" class="headerlink" title="如何查看自己是什么系统："></a>如何查看自己是什么系统：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>
<h4 id="在CentOS-7-以及RedHat-Oracle-Science-Linux-7-上，使用下面的命令打开系统防火墙中的HTTP和SSH访问。"><a href="#在CentOS-7-以及RedHat-Oracle-Science-Linux-7-上，使用下面的命令打开系统防火墙中的HTTP和SSH访问。" class="headerlink" title="在CentOS 7(以及RedHat/Oracle/Science Linux 7)上，使用下面的命令打开系统防火墙中的HTTP和SSH访问。"></a>在CentOS 7(以及RedHat/Oracle/Science Linux 7)上，使用下面的命令打开系统防火墙中的HTTP和SSH访问。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl enable sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br></pre></td></tr></table></figure>
<p>在执行 <code>sudo firewall-cmd --permanent --add-service=http</code> 时可能会遇到 <code>FirewallD is not running</code> 错误提示，意思是<code>未运行防火墙</code>。<br>使用以下命令开启防火墙即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br></pre></td></tr></table></figure></p>
<h4 id="接下来，安装-Postfix-邮件通知服务。如果要使用其他解决方案，可跳过此步，并在安装GitLab之后配置外部SMTP服务器。"><a href="#接下来，安装-Postfix-邮件通知服务。如果要使用其他解决方案，可跳过此步，并在安装GitLab之后配置外部SMTP服务器。" class="headerlink" title="接下来，安装 Postfix 邮件通知服务。如果要使用其他解决方案，可跳过此步，并在安装GitLab之后配置外部SMTP服务器。"></a>接下来，安装 Postfix 邮件通知服务。如果要使用其他解决方案，可跳过此步，并在安装GitLab之后配置外部SMTP服务器。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl enable postfix</span><br><span class="line">sudo systemctl start postfix</span><br></pre></td></tr></table></figure>
<p>这一步可能会遇到一个报错 <code>Job for postfix.service failed because the control process exited with error code. See &quot;systemctl status postfix.service&quot; and &quot;journalctl -xe&quot; for details.</code><br>解决方法是修改 <code>/etc/postfix/main.cf</code> 的配置，使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/postfix/main.cf</span><br></pre></td></tr></table></figure></p>
<p>进入编辑 ‘main.cf’，按 <code>I</code> 进入修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inet_interfaces = all</span><br><span class="line">inet_protocols = ipv4 // 或 all</span><br></pre></td></tr></table></figure></p>
<p>修改完成后 依次按 <code>Esc</code>、<code>:</code>、<code>w</code>、<code>q</code>，回车保存修改，之后重启服务。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart postfix</span><br></pre></td></tr></table></figure></p>
<h3 id="Step2：添加GitLab包存储库并安装该包"><a href="#Step2：添加GitLab包存储库并安装该包" class="headerlink" title="Step2：添加GitLab包存储库并安装该包"></a>Step2：添加GitLab包存储库并安装该包</h3><h4 id="设置防火墙："><a href="#设置防火墙：" class="headerlink" title="设置防火墙："></a>设置防火墙：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 开启 8888 端口</span><br><span class="line">firewall-cmd --zone=public --add-port=8888/tcp --permanent</span><br><span class="line"># 重启防火墙</span><br><span class="line">systemctl restart firewalld</span><br></pre></td></tr></table></figure>
<h4 id="添加GitLab包的仓库"><a href="#添加GitLab包的仓库" class="headerlink" title="添加GitLab包的仓库"></a>添加GitLab包的仓库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure>
<h4 id="接下来，安装Gitlab包："><a href="#接下来，安装Gitlab包：" class="headerlink" title="接下来，安装Gitlab包："></a>接下来，安装Gitlab包：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL=&quot;https://gitlab.example.com&quot; yum install -y gitlab-ee</span><br></pre></td></tr></table></figure>
<p>将<a href="https://gitlab.example.com更改为您要访问GitLab实例的URL。" target="_blank" rel="noopener">https://gitlab.example.com更改为您要访问GitLab实例的URL。</a> 安装将自动配置并启动该URL的GitLab。 </p>
<p>我这里没有域名就直接使用 IP + 端口号的形式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL=&quot;xx.xx.xxx.xx:8888&quot; yum install -y gitlab-ee</span><br></pre></td></tr></table></figure></p>
<p>然后等待安装 </p>
<p>如果安装完之后要修改访问的域名或者 IP，则需修改 <code>/etc/gitlab/gitlab.rb</code> 文件中的 <code>external_url</code> 一项，修改方法与上面修改 <code>/etc/postfix/main.cf</code> 的一样。</p>
<p>之后重新配置服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></p>
<h3 id="Step3：登录"><a href="#Step3：登录" class="headerlink" title="Step3：登录"></a>Step3：登录</h3><p>经过上面，的安装与设置，就可以访问域名或者IP了。<br>打开xx.xx.xxx.xx:8888，需要设置<code>root帐号</code>的密码，之后即可使用root帐号登录。<br>这里忘记截图了，就附上用户设置的一张截图吧<br><img src="https://raw.githubusercontent.com/hbxywdk/hexo-blog/master/assets/2019-04/gitlab-user-setting.jpg" alt="设置"></p>
<h3 id="附"><a href="#附" class="headerlink" title="附:"></a>附:</h3><p>Gitlab常用命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//启动</span><br><span class="line">sudo gitlab-ctl start</span><br><span class="line"></span><br><span class="line">//停止</span><br><span class="line">sudo gitlab-ctl stop</span><br><span class="line"></span><br><span class="line">//重启</span><br><span class="line">sudo gitlab-ctl restart</span><br><span class="line"></span><br><span class="line">//查看状态</span><br><span class="line">sudo gitlab-ctl status</span><br><span class="line"></span><br><span class="line">//使更改配置生效</span><br><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h3><blockquote>
<p><a href="https://about.gitlab.com/install" target="_blank" rel="noopener">GitLab Installation</a><br><a href="https://blog.hhking.cn/2018/11/24/aliyun-gitlab-install/" target="_blank" rel="noopener">阿里云 GitLab 折腾笔记</a><br><a href="https://blog.csdn.net/tiweeny/article/details/73333806" target="_blank" rel="noopener">CentOS下yum命令出现Loaded plugins: fastestmirror</a><br><a href="https://zocodev.com/aliyun-ecs-errors-resolve.html" target="_blank" rel="noopener">Failed to set locale, defaulting to C解决</a></p>
</blockquote>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-04-16</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Linux/" title="Linux">Linux </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2019/04/16/阿里云安装Gitlab笔记/,DK'S BLOG,阿里云安装Gitlab笔记,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/04/17/安装Gitlab-runner/" title="安装Gitlab-runner">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/04/16/在Hexo生成的github博客中使用本地图片/" title="在Hexo生成的github博客中使用本地图片">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>